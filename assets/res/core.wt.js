var _prefix='[CORE.WT]';WT=window.WT||{};WT.Class={create:function(){return function(){this._init.apply(this,arguments);};}};console.log(_prefix+'START');M=window.M||WT.Main||{};M.loadScript=function(src,cb){var j=document.createElement("script");j.setAttribute("type","text/javascript");j.setAttribute("src",src);if(!!window.attachEvent){j.onreadystatechange=function(){if(j.readyState=="loaded"||j.readyState=="complete"){if(typeof(cb)=='function')
{cb();}}};}else{if(typeof(cb)=='function')
{j.onload=cb;}}
document.getElementsByTagName("head")[0].appendChild(j);};M.mask=WT.Class.create();M.mask.prototype={_z:100,mask:null,float:null,_init:function(){var _obj=this,_arg=arguments;_obj._z=($('.greyLayer').length+2)*10;if(_arg.length==0){this._showMask();}else{var _ar=_arg[0];if(typeof _ar=='object'){var _c=(typeof _ar.close=='undefined')?false:!!_ar.close;if(!_ar.id)_ar.id='#maskBox';_obj.float=$(_ar.id);if(_obj.float.css('display')=='none'){if(_ar.title||_ar.content){_obj._showCustom(_ar.title,_ar.content,_ar.time);}
_obj.float.css('z-index',_obj._z+1).show();_obj._showMask(_c);}}else if(typeof _ar=='string'){_obj.float=$(_ar);if(_obj.float.css('display')=='none'){_obj.float.css('z-index',_obj._z+1).show();_obj._showMask();}}}
$(document).bind('DOMNodeInserted',function(e){if($(e.target).html()!=''){var _bh=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),_gh=$('.greyLayer').height();if(_bh!=_gh){$('.greyLayer').height(_bh);}}});},hide:function(){var _obj=this;_obj.float&&_obj.float.hide();_obj.mask&&_obj.mask.hide();},show:function(){var _obj=this;_obj.float&&_obj.float.show();_obj.mask&&_obj.mask.show();},_showMask:function(){var _obj=this,_arg=arguments,_mask=_obj._greyLayer(null,_obj._z);_obj.mask=$(_mask);_obj.mask.show();_arg.length==0?false:_arg[0]&&_obj.mask.click(function(){_obj.hide();});},_showCustom:function(){var _obj=this,_arg=arguments;var _t=_arg[0]||'',_c=_arg[1]||'',_s=!isNaN(_arg[2])?parseInt(_arg[2]):2;var _tip=$('#maskBox');_tip.find('h1').html(_t);_tip.find('p').html(_c);if(_s==0)return;setTimeout(function(){_obj.hide();},_s*1000);},_greyLayer:function(){var _id=arguments[0]||(new Date()).getTime(),_zIndex=arguments[1]||this._z,_mask=document.createElement("div");_mask.id='greyLayer_'+_id;_mask.className='greyLayer';_mask.style.position="fixed";_mask.style.zIndex=_zIndex;_scrollWidth=Math.max(document.body.scrollWidth,document.documentElement.scrollWidth);_scrollHeight=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight);_mask.style.width=_scrollWidth+"px";_mask.style.height=_scrollHeight+"px";_mask.style.top="0px";_mask.style.left="0px";_mask.style.display="none";_mask.style.background="#33393C";_mask.style.filter="alpha(opacity=60)";_mask.style.opacity="0.60";document.body.appendChild(_mask);this._z=_zIndex;return _mask;}};M.getSurl=function(url){var _url=url,_S=null;var _urlt=window.location.href.split("?");if(_urlt.length>1){var _gets=_urlt[1].split("&");for(var i=0;i<_gets.length;i++){var _get=_gets[i].split("=");if(!!_get&&_get.length>0&&_get[0]=='S'){if(_get.length>1){_S=_get[1];break;}}}}
if(_S!=null){if(url.indexOf('?')==-1){_url+='?';}else{_url+='&';}
_url+='S='+_S;}else if(WT.Source!=null){if(url.indexOf('?')==-1){_url+='?';}else{_url+='&';}
_url+='S='+WT.Source;}
return _url;};M.open=function(){var _arg=arguments,_isMaskHide=false,_url=null;if(_arg.length>1){_url=_arg[0];if(!!_arg[1]){_isMaskHide=true;}}
M._loading=null;if(!_isMaskHide){if(M._loading==null)
M._loading=new M.mask('#loadingBox');else{M._loading.show();}}
setInterval(function(){if(M._loading!=null){M._loading.hide();}},4000);if(_arg.length==0){_url=WT.HTTP_REFERER||WT.SERVER_REFERER;if(!!_url){setTimeout(function(){window.history.back();},10);return;}else{_url='/';}}else{if(_arg.length==1){_url=_arg[0];}
if(_url==null){_url='/';}}
if(_url.indexOf('tel')==0){setTimeout(function(){location.assign(_url);},10);}else{setTimeout(function(){location.assign(M.getSurl(_url));},10);}};M.cache=null;M.containsUrl=function(){var _arg=arguments,_start=0,_url=WT.HTTP_REFERER||WT.SERVER_REFERER;if(_arg.length==0||!_arg[0])return false;else if(_arg[0].substr(0,7).toUpperCase()=='HTTP://'){if(_arg.length==1)return false;_url=_arg[0];_start=1;}
for(var i=_start;i<_arg.length;i++){if(_url.indexOf(arguments[i])>-1){return true;}}
return false;};M.id_inarray=function(_arr,_id){if(!_arr||!_id)return false;for(var i=0;i<_arr.length;i++){if(_arr[i]&&_arr[i].id&&_arr[i].id==_id)
return true;}
return false;};M.setScrollPage=function(_s){var _scrollPage=$('*[scrollPagination*="abled"]');if(!_s){if(_scrollPage.length>0){_scrollPage.attr('scrollPagination','disabled');}}else{if(_scrollPage.length>0){_scrollPage.attr('scrollPagination','enabled');}}};M.loadback=function(){var _t=$('#headRule'),_rule;try{_rule=_t.attr('data-rule');if(_rule==null){return;}_rule=eval('('+_rule+')');}catch(e){console.error(_prefix+e);return;}
if(typeof _rule!='object')return;for(var i=0;i<_rule.R.length;i++){if(rule(_rule.R[i].U,_rule.R[i].T))return;}
if(_rule.D&&_rule.D.U&&_rule.D.T){rule(_rule.D.U,_rule.D.T);}else{rule('/',1);}
function rule(U,T){if(T==1){T='去首页';U='/';_t.html(T);_click(U);return true;}
var _ref=WT.HTTP_REFERER;if(M.containsUrl(_ref,U)){if(!T){T=_t.html();}else if(T==1){T='去首页';U='/';}else if(T==2){T='返回上一页';U=null;}else if(T==3){T='返回商品详情';U=null;}else{T='<strong>微团购</strong>';U='/';}
_t.html(T);_click(U);return true;}
return false;}
function _click(_url){_t.click(function(){if(_url==null){M.open();}else{M.open(_url);}});}};M.getLocalCacheSize=function(){var len=0,strlen=null;if('localStorage'in window){for(var k in localStorage){len+=localStorage[k].length;}}
strlen=parseFloat(parseInt(len*1000/1024)/1000);var sizelog=_prefix+'CACHE_SIZE:'+strlen+'KB';if(len<5242880){console.log(sizelog);}
else{console.warn(sizelog);}
return len;};M._init=function(){M.loadback();M.getLocalCacheSize();};WT.Category={};WT.Category.cate_name=[];WT.Category.cacheKey='CATEGORY_ID';WT.Category.cacheData=null;WT.Category.cacheCount=null;WT.Category.cacheExpir=7*24*60;WT.Category.display=false;WT.Category.historyCache=null;WT.Category.history=function(){var cate_ids=$.cookie(WT.Category.cacheKey);if(!cate_ids||cate_ids.indexOf('-')==-1||WT.Category.historyCache!=null)return;if(WT.Category.cate_name.length==0){$('#hotelContainer li[hotel_id]').each(function(index){var cateObj={};cateObj.id=$(this).attr('cate_id')+'_'+$(this).attr('hotel_id');cateObj.name=decodeURIComponent($(this).attr('hotel_name')+$(this).attr('cate_name'));cateObj.type=cateObj.id.indexOf('_')>-1?'hotel':'';if(!M.id_inarray(WT.Category.cate_name,cateObj.id)){WT.Category.cate_name.push(cateObj);}});$('#cateAllList h2[cate_id]').each(function(index){var cateObj={};cateObj.id=$(this).attr('cate_id');cateObj.name=decodeURIComponent($(this).attr('cate_name'));cateObj.type='';if(!M.id_inarray(WT.Category.cate_name,cateObj.id)){WT.Category.cate_name.push(cateObj);}});$('#cateAllList li[cate_id]').each(function(index){var cateObj={};cateObj.id=$(this).attr('cate_id');cateObj.name=decodeURIComponent($(this).attr('cate_name'));cateObj.type='';if(!M.id_inarray(WT.Category.cate_name,cateObj.id)){WT.Category.cate_name.push(cateObj);}});}
var cate_array=null,_html='';cate_array=cate_ids.split('-');if(!cate_array||!cate_array.length||cate_array.length<3)return;for(var i=0;i<cate_array.length;i++){if(cate_array[i]&&(!isNaN(cate_array[i])||cate_array[i].indexOf('_')>-1)){$.each(WT.Category.cate_name,function(k,v){if(cate_array[i]==v.id){_html+='<li cate_id="'+v.id+'" cate_name="'+v.name+'" cate_type="'+v.type+'"  onclick="WT.Category.click(this,\''+v.id+'\', \''+v.name+'\', \''+v.type+'\')">'+v.name+'</li>';console.log(_prefix+v.id+v.name);}});}}
if(_html!=''){$('#cateHistoryList > .cate_list').append(_html);$('#cateHistoryList').show();WT.Category.historyCache=_html;}};WT.Category.count=function(data){var _v='';$.each(data,function(k,v){if(k&&!isNaN(k)&&v&&!isNaN(v.count)){_v='（'+v.count+'）';$('#cate_count_'+k).text(_v).show();}});};WT.Category.load=function(data,save){if(data&&data.indexOf('<!--OK-->')>-1&&data.substr(0,9)=='<!--OK-->'){M.setScrollPage();$('#main').hide();$('#dialog').html(data).show();WT.Category.display=true;WT.Bizarea.display=false;if(WT.Category.cacheCount==null){$.get('/ajax/deal/cateCount',function(data){if(!data||data.indexOf('retData')==-1)return;var jsonData;try{jsonData=JSON.parse(data);if(typeof jsonData!='object')return;}
catch(e){return;}
if(jsonData&&jsonData.retData){WT.Category.cacheCount=jsonData.retData;WT.Category.count(WT.Category.cacheCount);}});}else{WT.Category.count(WT.Category.cacheCount);}
WT.Category.history();if(WT.Category.cacheData==null)WT.Category.cacheData=data;if(!!save){$.localCache.set(WT.Category.cacheKey,data+'<!--'+WT.SERVER_VERSION+'-->',WT.Category.cacheExpir);}
if(window.location.pathname=='/'){$('.p_headback').text('返回首页');}}};WT.Category.show=function(){var city_id=$.cookie('CITY_ID');if(!city_id||isNaN(city_id)){M.open("/site/cities");}
if(WT.Category.display){$('#dialog #cateContainer').show();$('#dialog #hotelContainer').hide();return;}
if(WT.Category.cacheData!=null){WT.Category.load(WT.Category.cacheData);return;}
var localCache=$.localCache.get(WT.Category.cacheKey);if(localCache&&localCache.indexOf('<!--'+WT.SERVER_VERSION+'-->')>-1){WT.Category.load(localCache);return;}
var _maskCate=new M.mask('#loadingBox');$.get('/ajax/deal/catehotel',function(data){_maskCate.hide();WT.Category.load(data,true);});};WT.Category.hide=function(){$('#dialog').hide();$('#main').show();WT.Category.display=false;M.setScrollPage(true);};WT.Category.click=function(obj,cate_id,cate_name,cate_type){if(!obj)return;$(obj).addClass("on");if('130046'==cate_id){window.scroll(0,0);$('#cateContainer').hide();$('#hotelContainer').show();window.cityScript.init();return;}
if(typeof cate_type!='undefined'&&cate_type==1){var cate_child=$('#cateAllList .cate_list[cate_id~="'+cate_id+'"]');var isHide=cate_child.css('display')=='none'?true:false;$('#cateAllList .cate_list').hide();$('#cateAllList .cate_title i').removeClass('title_ico_on');if(isHide){cate_child.show();$(obj).find('i').addClass('title_ico_on');}else{cate_child.hide();$(obj).find('i').removeClass('title_ico_on');}}else{var act='soType=cate';if('hotel'==cate_type&&cate_id.indexOf('_')>-1){var i=cate_id.indexOf('_');var hotel_id=cate_id.substr(i+1);cate_id=cate_id.substr(0,hotel_id.length);var hotel_name=encodeURIComponent(cate_name);act='soType=hotel&hotelId='+hotel_id+'&hotelName='+hotel_name;}
var url='/deal/search?'+act+'&cateId='+cate_id+'&cateName='+encodeURIComponent(cate_name);M.open(url);}};WT.Category._bind=function(){$(document).delegate(".p_nav_cate","click",function(){WT.Category.show();});};WT.Category._init=function(){var hash=window.location.hash;if(hash.indexOf('#category')>-1){WT.Category.show();}
WT.Category._bind();};WT.Bizarea={};WT.Bizarea.area_name=[];WT.Bizarea.cacheKey='BIZAREA_ID';WT.Bizarea.cacheData=null;WT.Bizarea.cacheCount=null;WT.Bizarea.cacheExpir=7*24*60;WT.Bizarea.display=false;WT.Bizarea.historyCache=null;WT.Bizarea.history=function(){var area_ids=$.cookie(WT.Bizarea.cacheKey);if(!area_ids||area_ids.indexOf('-')==-1||WT.Bizarea.historyCache!=null)return;if(WT.Bizarea.area_name.length==0){$('#bizareaAllList h2[area_id]').each(function(index){var areaObj={};areaObj.id=$(this).attr('area_id');areaObj.name=decodeURIComponent($(this).attr('area_name'));areaObj.type='';if(!M.id_inarray(WT.Bizarea.area_name,areaObj.id)){WT.Bizarea.area_name.push(areaObj);}});$('#bizareaAllList li[area_id]').each(function(index){var areaObj={};areaObj.id=$(this).attr('area_id');areaObj.name=decodeURIComponent($(this).attr('area_name'));areaObj.type='';if(!M.id_inarray(WT.Bizarea.area_name,areaObj.id)){WT.Bizarea.area_name.push(areaObj);}});}
var area_array=null,_html='';area_array=area_ids.split('-');if(!area_array||!area_array.length||area_array.length<3)return;for(var i=0;i<area_array.length;i++){if(area_array[i]&&(!isNaN(area_array[i])||area_array[i].indexOf('_')>-1)){$.each(WT.Bizarea.area_name,function(k,v){if(area_array[i]==v.id){_html+='<li area_id="'+v.id+'" area_name="'+v.name+'" area_type="'+v.type+'"  onclick="WT.Bizarea.click(this,\''+v.id+'\', \''+v.name+'\', \''+v.type+'\')">'+v.name+'</li>';console.log(_prefix+v.id+v.name);}});}}
if(_html!=''){$('#areaHistoryList > .area_list').append(_html);$('#areaHistoryList').show();WT.Bizarea.historyCache=_html;}};WT.Bizarea.count=function(data){var _v='';$.each(data,function(k,v){if(k&&!isNaN(k)&&v&&!isNaN(v.count)){_v='（'+v.count+'）';$('#area_count_'+k).text(_v).show();}});};WT.Bizarea.load=function(data,save){if(data&&data.indexOf('<!--OK-->')>-1&&data.substr(0,9)=='<!--OK-->'){M.setScrollPage();$('#main').hide();$('#dialog').html(data).show();WT.Bizarea.display=true;WT.Category.display=false;if(WT.Bizarea.cacheCount==null){$.get('/ajax/deal/areaCount',function(data){if(!data||data.indexOf('retData')==-1)return;var jsonData;try{jsonData=JSON.parse(data);if(typeof jsonData!='object')return;}
catch(e){return;}
if(jsonData&&jsonData.retData){WT.Bizarea.cacheCount=jsonData.retData;WT.Bizarea.count(WT.Bizarea.cacheCount);}});}else{WT.Bizarea.count(WT.Bizarea.cacheCount);}
WT.Bizarea.history();if(WT.Bizarea.cacheData==null)WT.Bizarea.cacheData=data;if(!!save){var city_id=$.cookie('CITY_ID');if(typeof city_id!='undefined'&&city_id!=null&&!isNaN(city_id)){$.localCache.set(WT.Bizarea.cacheKey+'_'+city_id,data,WT.Bizarea.cacheExpir);}}
if(window.location.pathname=='/'){$('.p_headback').text('返回首页');}}};WT.Bizarea.show=function(){var city_id=$.cookie('CITY_ID');if(!city_id||isNaN(city_id)){M.open("/site/cities");}
if(WT.Bizarea.display){return;}
if(WT.Bizarea.cacheData!=null){WT.Bizarea.load(WT.Bizarea.cacheData);return;}
var localCache=$.localCache.get(WT.Bizarea.cacheKey+'_'+city_id);if(localCache){WT.Bizarea.load(localCache);return;}
var _maskArea=new M.mask('#loadingBox');$.get('/ajax/deal/bizarea',function(data){var _jsonData=null;try{_jsonData=JSON.parse(data);if(_jsonData&&_jsonData.retData&&_jsonData.retData.list=='4'){_maskArea.hide();new M.mask({title:'您当前所选城市未开通商圈哦~'});return;}}catch(e){}
_maskArea.hide();WT.Bizarea.load(data,true);});};WT.Bizarea.hide=function(){$('#dialog').hide();$('#main').show();WT.Bizarea.display=false;M.setScrollPage(true);};WT.Bizarea.click=function(obj,area_id,area_name,area_type){if(!obj)return;$(obj).addClass("on");if(typeof area_type!='undefined'&&area_type==1){var area_child=$('#bizareaAllList .area_list[area_id~="'+area_id+'"]');var isHide=area_child.css('display')=='none'?true:false;$('#bizareaAllList .area_list').hide();$('#bizareaAllList .area_title i').removeClass('title_ico_on');if(isHide){area_child.show();$(obj).find('i').addClass('title_ico_on');}else{area_child.hide();$(obj).find('i').removeClass('title_ico_on');}}else{var url='/deal/search?soType=area&areaId='+area_id+'&areaName='+encodeURIComponent(area_name);M.open(url);}};WT.Bizarea._bind=function(){$(document).delegate(".p_nav_area","click",function(){WT.Bizarea.show();});};WT.Bizarea._init=function(){var hash=window.location.hash;if(hash.indexOf('#bizarea')>-1){WT.Bizarea.show();}
WT.Bizarea._bind();};WT._bind=function(){$('#btnDownApp').click(function(){var url=null;if(isAndroid)url=$('#androidDownUrl').attr('data-url');else if(isIDevice)url=$('#iosDownUrl').attr('data-url');if(url!=null){window.location.href=url;return;}
new M.mask({id:'#selectDownApp',close:true});});$(document).bind('DOMNodeInserted',function(e){if($(e.target).html()!=''){$("img").error(function(){var _defimg="/images/pro_small_none.png";if(this.src==_defimg)return false;this.src=_defimg;});}});};WT._init=function(){WT.Category._init();WT.Bizarea._init();M._init();WT._bind();};WT.Main=window.M;$(function(){WT._init();});window.onload=function(){M.loadScript('http://pingjs.qq.com/tcss.ping.js',function(){var _pgData=_ptg.join('_');var _pmFn=typeof(pgvMain);if(_pmFn=='function'){console.log(_prefix+_pgData);pgvMain({virtualDomain:WT.DOMAIN,pgUserType:_pgData});if(typeof(pgvSendClick)=='function'){pgvSendClick({virtualDomain:WT.DOMAIN,hottag:_tcss_hottags.join(';')});}}});WT.TIME_TRACKER.LOAD_TIME('LOAD');};